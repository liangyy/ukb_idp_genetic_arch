library(dplyr)

df_idp = data.table::fread('~/Desktop/tmp/ukb_idp/idp_phenotypes/archive/2020-05-07_idp-phenotypes_cleaned.txt', sep = '\t', data.table = F)
df_covar = data.table::fread('~/Desktop/tmp/ukb_idp/idp_phenotypes/2020-05-18_covariates.csv', sep = '\t', data.table = F)
df_idp2 = arrow::read_parquet('~/Desktop/tmp/ukb_idp/idp_phenotypes/2020-05-18_image-derived-phenotypes.parquet')
df_idp3 = arrow::read_parquet('~/Desktop/tmp/ukb_idp/idp_phenotypes/2020-05-18_final-phenotypes.parquet')
df_idp3$individual = as.numeric(df_idp3$individual)
df_pheno = data.table::fread('~/Documents/repo/github/ptrs-ukb/output/query_phenotypes_cleaned_up.csv', sep = ',', data.table = F)

# head(df_idp[, 1:5])
# hist(df_idp[, 3])
# hist(df_idp[, 'IDP-25000'])
# head(df_pheno)


df = inner_join(df_pheno, df_idp, by = c('eid' = 'individual'))
df2 = inner_join(df_pheno, df_idp2, by = c('eid' = 'individual'))
df3 = inner_join(df_pheno, df_idp3, by = c('eid' = 'individual'))
plot(df[, 'height'], df[, 'IDP-25000'])
plot(df[, 'height'], 1 / df[, 'IDP-25000'])
# 25001: Volume of peripheral cortical grey matter (normalised for head size)
# 25002: Volume of peripheral cortical grey matter
plot(df[, 'IDP-25001'], df[, 'IDP-25002'])
plot(df[, 'IDP-25001'], df[, 'IDP-25002'] * df[, 'IDP-25000'])
plot(df[, 'height'], df[, 'IDP-25001'])
plot(df[, 'height'], df[, 'IDP-25002'])

# 25011: Volume of thalamus (left)
plot(df[, 'height'], df[, 'IDP-25011'])
plot(df[, 'height'], df[, 'IDP-25011'] * df[, 'IDP-25000'])
plot(df2[, 'height'], df2[, 'IDP-25011'])
plot(df3[, 'height'], df3[, 'IDP-25011'])
tmp = inner_join(df3, df, by = 'eid', suffix = c('.owen', '.raw'))
tmp2 = inner_join(df3, df2 %>% mutate(eid = as.numeric(eid)), by = 'eid', suffix = c('.owen', '.inrt'))
plot(tmp[, 'IDP-25011.raw'] * tmp[, 'IDP-25000'], tmp[, 'IDP-25011.owen'])
plot(tmp2[, 'IDP-25011.inrt'], tmp2[, 'IDP-25011.owen'])


# 25899: Volume of grey matter in VI Cerebellum (right)
plot(df[, 'height'], df[, 'IDP-25899'])
plot(df[, 'height'], df[, 'IDP-25899'] * df[, 'IDP-25000'])
plot(df2[, 'height'], df2[, 'IDP-25899'])
plot(df3[, 'height'], df3[, 'IDP-25899'])
# tmp = inner_join(df3, df, by = 'eid', suffix = c('.owen', '.raw'))
# tmp2 = inner_join(df3, df2 %>% mutate(eid = as.numeric(eid)), by = 'eid', suffix = c('.owen', '.inrt'))
plot(tmp[, 'IDP-25899.raw'] * tmp[, 'IDP-25000'], tmp[, 'IDP-25899.owen'])
plot(tmp2[, 'IDP-25899.inrt'], tmp2[, 'IDP-25899.owen'])


# 25070: Mean FA in cerebral peduncle on FA skeleton (right)
plot(df[, 'height'], df[, 'IDP-25070'])
plot(df2[, 'height'], df2[, 'IDP-25070'])
plot(df3[, 'height'], df3[, 'IDP-25070'])
# tmp = inner_join(df3, df, by = 'eid')
plot(tmp[, 'IDP-25070.raw'], tmp[, 'IDP-25070.owen'])
plot(tmp2[, 'IDP-25070.inrt'], tmp2[, 'IDP-25070.owen'])

# 25118: Mean MD in cerebral peduncle on FA skeleton (right)
plot(df[, 'height'], df[, 'IDP-25118'])
plot(df2[, 'height'], df2[, 'IDP-25118'])
plot(df3[, 'height'], df3[, 'IDP-25118'])
# tmp = inner_join(df3, df, by = 'eid')
plot(tmp[, 'IDP-25118.raw'], tmp[, 'IDP-25118.owen'])
plot(tmp2[, 'IDP-25118.inrt'], tmp2[, 'IDP-25118.owen'])

# 25878: Volume of grey matter in Thalamus (left)
plot(df[, 'height'], df[, 'IDP-25878'])
plot(df[, 'height'], df[, 'IDP-25878'] * df[, 'IDP-25000'])
plot(df2[, 'height'], df2[, 'IDP-25878'])
plot(df3[, 'height'], df3[, 'IDP-25878'])
# tmp = inner_join(df3, df, by = 'eid')
plot(tmp[, 'IDP-25878.raw'] * tmp[, 'IDP-25000'], tmp[, 'IDP-25878.owen'])
plot(tmp2[, 'IDP-25878.inrt'], tmp2[, 'IDP-25878.owen'])
